<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>beer-game.logic.game documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">beer-game.server</span> <span class="project-version">master</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>beer-game</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>components</span></div></div></li><li class="depth-3 branch"><a href="beer-game.components.handler.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>handler</span></div></a></li><li class="depth-3 branch"><a href="beer-game.components.routes.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>routes</span></div></a></li><li class="depth-3 branch"><a href="beer-game.components.webserver.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>webserver</span></div></a></li><li class="depth-3"><a href="beer-game.components.websocket.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>websocket</span></div></a></li><li class="depth-2 branch"><a href="beer-game.config.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>config</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>handlers</span></div></div></li><li class="depth-3 branch"><a href="beer-game.handlers.auth.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>auth</span></div></a></li><li class="depth-3 branch"><a href="beer-game.handlers.auth-test.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>auth-test</span></div></a></li><li class="depth-3 branch"><a href="beer-game.handlers.events.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>events</span></div></a></li><li class="depth-3 branch"><a href="beer-game.handlers.events-test.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>events-test</span></div></a></li><li class="depth-3 branch"><a href="beer-game.handlers.game.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>game</span></div></a></li><li class="depth-3"><a href="beer-game.handlers.system.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>system</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -207px;"><span class="top" style="height: 216px;"></span><span class="bottom"></span></span><span>logic</span></div></div></li><li class="depth-3 branch current"><a href="beer-game.logic.game.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>game</span></div></a></li><li class="depth-3"><a href="beer-game.logic.game-logic-test.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>game-logic-test</span></div></a></li><li class="depth-2 branch"><a href="beer-game.message-handler.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>message-handler</span></div></a></li><li class="depth-2 branch"><a href="beer-game.message-handler-test.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>message-handler-test</span></div></a></li><li class="depth-2 branch"><a href="beer-game.messages.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>messages</span></div></a></li><li class="depth-2 branch"><a href="beer-game.server.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>server</span></div></a></li><li class="depth-2 branch"><a href="beer-game.server-utils.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>server-utils</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>spec</span></div></div></li><li class="depth-3 branch"><a href="beer-game.spec.event.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>event</span></div></a></li><li class="depth-3"><a href="beer-game.spec.game.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>game</span></div></a></li><li class="depth-2 branch"><a href="beer-game.store.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>store</span></div></a></li><li class="depth-2 branch"><a href="beer-game.store-test.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>store-test</span></div></a></li><li class="depth-2 branch"><a href="beer-game.test-util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>test-util</span></div></a></li><li class="depth-2 branch"><a href="beer-game.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2"><a href="beer-game.util-test.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util-test</span></div></a></li><li class="depth-1"><a href="user.html"><div class="inner"><span class="tree" style="top: -920px;"><span class="top" style="height: 929px;"></span><span class="bottom"></span></span><span>user</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="beer-game.logic.game.html#var-apply-round-update"><div class="inner"><span>apply-round-update</span></div></a></li><li class="depth-1"><a href="beer-game.logic.game.html#var-apply-user-ready"><div class="inner"><span>apply-user-ready</span></div></a></li><li class="depth-1"><a href="beer-game.logic.game.html#var-calc-deliverable"><div class="inner"><span>calc-deliverable</span></div></a></li><li class="depth-1"><a href="beer-game.logic.game.html#var-calc-to-deliver"><div class="inner"><span>calc-to-deliver</span></div></a></li><li class="depth-1"><a href="beer-game.logic.game.html#var-calc-user-demand"><div class="inner"><span>calc-user-demand</span></div></a></li><li class="depth-1"><a href="beer-game.logic.game.html#var-get-in0"><div class="inner"><span>get-in0</span></div></a></li><li class="depth-1"><a href="beer-game.logic.game.html#var-handle-commit"><div class="inner"><span>handle-commit</span></div></a></li><li class="depth-1"><a href="beer-game.logic.game.html#var-handle-ready"><div class="inner"><span>handle-ready</span></div></a></li><li class="depth-1"><a href="beer-game.logic.game.html#var-init-game-data"><div class="inner"><span>init-game-data</span></div></a></li><li class="depth-1"><a href="beer-game.logic.game.html#var-init-game-round"><div class="inner"><span>init-game-round</span></div></a></li><li class="depth-1"><a href="beer-game.logic.game.html#var-init-game-rounds"><div class="inner"><span>init-game-rounds</span></div></a></li><li class="depth-1"><a href="beer-game.logic.game.html#var-init-round-role"><div class="inner"><span>init-round-role</span></div></a></li><li class="depth-1"><a href="beer-game.logic.game.html#var-init-round-roles"><div class="inner"><span>init-round-roles</span></div></a></li><li class="depth-1"><a href="beer-game.logic.game.html#var-maybe-next-round"><div class="inner"><span>maybe-next-round</span></div></a></li><li class="depth-1"><a href="beer-game.logic.game.html#var-overall-cost"><div class="inner"><span>overall-cost</span></div></a></li><li class="depth-1"><a href="beer-game.logic.game.html#var-role-stock-update-fn"><div class="inner"><span>role-stock-update-fn</span></div></a></li><li class="depth-1"><a href="beer-game.logic.game.html#var-roles-around"><div class="inner"><span>roles-around</span></div></a></li><li class="depth-1"><a href="beer-game.logic.game.html#var-round-completed.3F"><div class="inner"><span>round-completed?</span></div></a></li><li class="depth-1"><a href="beer-game.logic.game.html#var-start-game"><div class="inner"><span>start-game</span></div></a></li><li class="depth-1"><a href="beer-game.logic.game.html#var-transform-game-settings"><div class="inner"><span>transform-game-settings</span></div></a></li><li class="depth-1"><a href="beer-game.logic.game.html#var-update-stocks"><div class="inner"><span>update-stocks</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">beer-game.logic.game</h1><div class="doc"><div class="markdown"><p>The domain-specific game logic. Used to initialize, interpret and update the game data maps according to the beer-game algorithms. This namespace is available on both client and server, though it is currently only really used from the server side.</p></div></div><div class="public anchor" id="var-apply-round-update"><h3>apply-round-update</h3><div class="usage"><code>(apply-round-update rounds cur-round {:as settings, :keys [:game/supply-chain stock-cost-factor debt-cost-factor communication-delay goods-delay]} {:as commit, :keys [:round/order :user/role]})</code></div><div class="doc"><div class="markdown"><p>Applies a commit to the game rounds vector.</p></div></div><div class="src-link"><a href="https://git.rz.uni-augsburg.de/pi-m/beer_game/blob/master/src/cljc/beer_game/logic/game.cljc#L82">view source</a></div></div><div class="public anchor" id="var-apply-user-ready"><h3>apply-user-ready</h3><div class="usage"><code>(apply-user-ready round user-role)</code></div><div class="doc"><div class="markdown"><p>Applies an update to the given round that signals that the given user is ready for the next round.</p></div></div><div class="src-link"><a href="https://git.rz.uni-augsburg.de/pi-m/beer_game/blob/master/src/cljc/beer_game/logic/game.cljc#L131">view source</a></div></div><div class="public anchor" id="var-calc-deliverable"><h3>calc-deliverable</h3><div class="usage"><code>(calc-deliverable round-roles role)</code><code>(calc-deliverable role-data)</code></div><div class="doc"><div class="markdown"><p>Calculates how much a the given unit can deliver, and if possible, how much of its debt it can pay off.</p></div></div><div class="src-link"><a href="https://git.rz.uni-augsburg.de/pi-m/beer_game/blob/master/src/cljc/beer_game/logic/game.cljc#L69">view source</a></div></div><div class="public anchor" id="var-calc-to-deliver"><h3>calc-to-deliver</h3><div class="usage"><code>(calc-to-deliver role-data)</code></div><div class="doc"><div class="markdown"><p>Given the round-data for one user-role, returns the amount of goods they have to deliver.</p></div></div><div class="src-link"><a href="https://git.rz.uni-augsburg.de/pi-m/beer_game/blob/master/src/cljc/beer_game/logic/game.cljc#L27">view source</a></div></div><div class="public anchor" id="var-calc-user-demand"><h3>calc-user-demand</h3><div class="usage"><code>(calc-user-demand settings current-round)</code></div><div class="doc"><div class="markdown"><p>Returns the user-demand for the <code>current-round</code> given the <code>settings</code> of the game.</p></div></div><div class="src-link"><a href="https://git.rz.uni-augsburg.de/pi-m/beer_game/blob/master/src/cljc/beer_game/logic/game.cljc#L147">view source</a></div></div><div class="public anchor" id="var-get-in0"><h3>get-in0</h3><div class="usage"><code>(get-in0 coll ks)</code></div><div class="doc"><div class="markdown"><p>Like <code>clojure.core/get-in</code> but with 0 for a not-found or <code>nil</code> value.</p></div></div><div class="src-link"><a href="https://git.rz.uni-augsburg.de/pi-m/beer_game/blob/master/src/cljc/beer_game/logic/game.cljc#L11">view source</a></div></div><div class="public anchor" id="var-handle-commit"><h3>handle-commit</h3><div class="usage"><code>(handle-commit {:as cur-game-data, cur-round :game/current-round, cur-rounds :game/rounds, settings :game/settings} {:as commit, commit-orders :round/order, user-role :user/role})</code></div><div class="doc"><div class="markdown"><p>Handles the game-round commit requested by a client. Endpoint for calls from the outside.</p></div></div><div class="src-link"><a href="https://git.rz.uni-augsburg.de/pi-m/beer_game/blob/master/src/cljc/beer_game/logic/game.cljc#L187">view source</a></div></div><div class="public anchor" id="var-handle-ready"><h3>handle-ready</h3><div class="usage"><code>(handle-ready {:as cur-game-data, cur-round :game/current-round, cur-rounds :game/rounds, settings :game/settings} {:as ready-data, target-round :target-round, user-role :user/role})</code></div><div class="doc"><div class="markdown"><p>Handles a clients signal that they are ready for the next round.</p></div></div><div class="src-link"><a href="https://git.rz.uni-augsburg.de/pi-m/beer_game/blob/master/src/cljc/beer_game/logic/game.cljc#L235">view source</a></div></div><div class="public anchor" id="var-init-game-data"><h3>init-game-data</h3><div class="usage"><code>(init-game-data)</code><code>(init-game-data {:as data, :keys [:game/settings]})</code></div><div class="doc"><div class="markdown"><p>Initializes a game-data map or ensures complete game-data for the given partial data-map.</p></div></div><div class="src-link"><a href="https://git.rz.uni-augsburg.de/pi-m/beer_game/blob/master/src/cljc/beer_game/logic/game.cljc#L337">view source</a></div></div><div class="public anchor" id="var-init-game-round"><h3>init-game-round</h3><div class="usage"><code>(init-game-round settings)</code></div><div class="doc"><div class="markdown"><p>Initializes the map for one game round.</p></div></div><div class="src-link"><a href="https://git.rz.uni-augsburg.de/pi-m/beer_game/blob/master/src/cljc/beer_game/logic/game.cljc#L312">view source</a></div></div><div class="public anchor" id="var-init-game-rounds"><h3>init-game-rounds</h3><div class="usage"><code>(init-game-rounds {:as settings, :keys [round-amount]})</code></div><div class="doc"><div class="markdown"><p>Initializes the rounds-vector for a game.</p></div></div><div class="src-link"><a href="https://git.rz.uni-augsburg.de/pi-m/beer_game/blob/master/src/cljc/beer_game/logic/game.cljc#L317">view source</a></div></div><div class="public anchor" id="var-init-round-role"><h3>init-round-role</h3><div class="usage"><code>(init-round-role {:as settings, :keys [initial-stock initial-incoming initial-outgoing]} user-role)</code></div><div class="doc"><div class="markdown"><p>Initializes the round role information for one user.</p></div></div><div class="src-link"><a href="https://git.rz.uni-augsburg.de/pi-m/beer_game/blob/master/src/cljc/beer_game/logic/game.cljc#L287">view source</a></div></div><div class="public anchor" id="var-init-round-roles"><h3>init-round-roles</h3><div class="usage"><code>(init-round-roles settings)</code></div><div class="doc"><div class="markdown"><p>Initializes the role map for one round.</p></div></div><div class="src-link"><a href="https://git.rz.uni-augsburg.de/pi-m/beer_game/blob/master/src/cljc/beer_game/logic/game.cljc#L303">view source</a></div></div><div class="public anchor" id="var-maybe-next-round"><h3>maybe-next-round</h3><div class="usage"><code>(maybe-next-round {:as update-data, {:as game-data, cur-round :game/current-round, {:as settings, :keys [:game/supply-chain]} :game/settings} :game/data})</code></div><div class="doc"><div class="markdown"><p>Takes an update data map and applies the transformations required to start the next round. Also requires the current-round and the game settings to be passed. If the round is not completed yet, just returns the update-data map. </p></div></div><div class="src-link"><a href="https://git.rz.uni-augsburg.de/pi-m/beer_game/blob/master/src/cljc/beer_game/logic/game.cljc#L160">view source</a></div></div><div class="public anchor" id="var-overall-cost"><h3>overall-cost</h3><div class="usage"><code>(overall-cost rounds user-role)</code></div><div class="doc"><div class="markdown"><p>Takes a round vector and returns the overall cost for the entire game (summing up the cost for each round) for the given user-role.</p></div></div><div class="src-link"><a href="https://git.rz.uni-augsburg.de/pi-m/beer_game/blob/master/src/cljc/beer_game/logic/game.cljc#L349">view source</a></div></div><div class="public anchor" id="var-role-stock-update-fn"><h3>role-stock-update-fn</h3><h4 class="deprecated">deprecated</h4><div class="usage"><code>(role-stock-update-fn rounds cur-round)</code></div><div class="doc"><div class="markdown"><p>Update all the stocks after all players have commited to a round.</p></div></div><div class="src-link"><a href="https://git.rz.uni-augsburg.de/pi-m/beer_game/blob/master/src/cljc/beer_game/logic/game.cljc#L34">view source</a></div></div><div class="public anchor" id="var-roles-around"><h3>roles-around</h3><div class="usage"><code>(roles-around role supply-chain)</code></div><div class="doc"><div class="markdown"><p>Returns the roles before and after the passed role in the supply chain.</p></div></div><div class="src-link"><a href="https://git.rz.uni-augsburg.de/pi-m/beer_game/blob/master/src/cljc/beer_game/logic/game.cljc#L16">view source</a></div></div><div class="public anchor" id="var-round-completed.3F"><h3>round-completed?</h3><div class="usage"><code>(round-completed? {:as round-data, :keys [:game/roles]} supply-chain)</code></div><div class="doc"><div class="markdown"><p>Takes the current round map and the game supply chain and returns true if the round is completed.</p></div></div><div class="src-link"><a href="https://git.rz.uni-augsburg.de/pi-m/beer_game/blob/master/src/cljc/beer_game/logic/game.cljc#L137">view source</a></div></div><div class="public anchor" id="var-start-game"><h3>start-game</h3><div class="usage"><code>(start-game game-data user-roles)</code></div><div class="doc"><div class="markdown"><p>Updates the given <code>game-data</code> map by adding all the data required to start the game.</p></div></div><div class="src-link"><a href="https://git.rz.uni-augsburg.de/pi-m/beer_game/blob/master/src/cljc/beer_game/logic/game.cljc#L278">view source</a></div></div><div class="public anchor" id="var-transform-game-settings"><h3>transform-game-settings</h3><div class="usage"><code>(transform-game-settings settings)</code></div><div class="doc"><div class="markdown"><p>Transforms the game settings, trying to make it adhere to the spec (like transforming strings to integers).</p></div></div><div class="src-link"><a href="https://git.rz.uni-augsburg.de/pi-m/beer_game/blob/master/src/cljc/beer_game/logic/game.cljc#L324">view source</a></div></div><div class="public anchor" id="var-update-stocks"><h3>update-stocks</h3><h4 class="deprecated">deprecated</h4><div class="usage"><code>(update-stocks rounds cur-round {:as settings, :keys [:game/supply-chain]})</code></div><div class="doc"><div class="markdown"><p>Update all the stock values when a round is done.</p></div></div><div class="src-link"><a href="https://git.rz.uni-augsburg.de/pi-m/beer_game/blob/master/src/cljc/beer_game/logic/game.cljc#L58">view source</a></div></div></div></body></html>